# 结题报告

## 1 项目简介

本项目搭建了一个分布式时序计算平台，并将该平台应用在了量化交易上。我们将一个分布式计算框架Rain，与一个时序数据库yijinjing结合起来，利用分布式特性实现任务分发，使不同节点监控不同股票，利用时序数据库读写速度极快的特性实现高频量化交易。

## 2 立项依据

时序数据是同一统一指标按时间顺序记录的数据列。在同一数据列中的各个数据是同口径的，具有可比性。时序数据可以是时期数，也可以时点数。时间序列分析的目的是通过找出样本内时间序列的统计特性和发展规律性，构建时间序列模型，进行样本外预测。利用好时序数据可以揭示可操作的趋势，模式，可变性等重要参数。

可见，快速地处理时序数据并从中获取信息可以产生巨大的价值与能量，对时序数据高速有效地处理的需求如今也在逐渐增大。

超级计算在现代科学中发挥着重要的作用，例如天文、化学等很多领域的研究都需要进行繁重的计算任务来模拟行为或者搜索结果。然而，超级计算成本非常高昂，这迫使许多实验只能“从简”，妨碍了科学的发展。

分布式计算是超级计算的一种很好的替代方法。对于一些大型的计算项目，可以由服务器分成很多小的计算任务，分发给与服务器相连的节点，同时计算，再将结果返回，由服务器整合。这样虽然速度比超级计算慢，但相比于传统单机运行，速度大大提升，而且成本较超级计算而言微乎其微。

所以我们使用分布式计算框架Rain结合时序数据库yijinjing搭建分布式时序计算平台。

## 3 设计与实现

### 3.1 yijinjing

#### 3.1.1 为什么选择易筋经

市场上主流的数据库，第一优先的核心功能是查询，在海量数据中快速定位到查询的那一条。数据结构在内存中的设计更像是一个巨大的哈希表，这注定相邻数据不会存在连续内存区域，访问和写入数据都存在一定的开销。

​而我们这次设计的是面向时间序列的分布式计算平台，数据库部分的目的是在大量时间序列数据输入的情况下，把数据存储下来，便于后续的分析。我们在github上找到了开源项目易筋经数据库。易筋经使用mmap作为底层存储机制，本质上是通过操作系统 kernel 后台进程异步完成内存内容到磁盘文件的同步操作，意味着它赋予了一种在操作内存同时以零延时来操作磁盘文件的能力，使得我们无需担心数据持久化方面的耗时，帮助我们同时完成通信和存储这两个重要任务，这是使用 mmap 方法的精髓所在。

#### 3.1.2 接口实现

​Rain提供了python的接口，而易筋经本身是用C++编写的，要用Rain调用易筋经，需要编写一些基本接口。我的工作就是设计基本的写入数据，读出数据，打印数据和把数据转化为.csv格式文件的API。

已实现部分：

```python
def writeSingleData(data,msgType,jname)
def readSingleData(readtime,jname)
def readSingleMsgType(readtime,jname)
def printAllData(startTime,jname)
def convertAllToCSV(startTime,fileName,jname)
def readCSV(filename,jname)
def deleteJournal(dir,jname)
```

已设计但未实现部分：

```python
def expireJournal(journalName)
def initJournal(dir,jname)
def expireJournalByIndex(index,journalName)
```

​`data`是数据本体，`msgType`用来标记数据类型，`jname`指定把数据写入到哪一个`Journal`部分。一个`Journal`对应一次写入事件。调用`writeSingleData`时会将数据写入数据库，以二进制文件的形式保存，同时会返回一个时间戳，想要读取数据时可以通过时间戳来读取对应位置的数据或者打印从特定位置开始的所有数据。如果要进行数据的整体分析，提供了`converAllToCSV`接口，将指定Journal内从特定时间开始的数据全部转换为`.csv`格式，便于后续分析。

#### 3.1.3 测试过程

易筋经数据库的写入速度：

![files](./img/yjjwrite.png)

读取数据速度：

![files](./img/yjjread.png)


### 3.2 Rain

### 3.3 拼接

## 4 成果



## 5 未来改进



## 6 回顾与总结


